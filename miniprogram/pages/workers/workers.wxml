<view class="container">

<!-- 空状态 -->
<van-empty
  wx:if="{{workers.length === 0}}"
  description="暂无工人，点击右下角新增" />

<!-- 工人网格 -->
<view class="workers-page">
  <view class="worker-grid">
    <block wx:for="{{workers}}" wx:key="id" wx:for-item="item">
      <view class="worker-item" bindtap="onTapWorker" data-id="{{item.id}}">
        <view class="card">
          <van-image class="avatar" round fit="cover"
            src="{{item.avatar || defaultAvatarUrl}}"
          ></van-image>
          <view class="info">
            <view class="name">{{item.name}}</view>
            <view class="phone">{{item.phone || '未填写'}}</view>
          </view>

          <view class="card-actions">
            <van-button class="qr-btn" size="small" round
              type="primary" icon="qr" plain catch:tap="onShowQr"
              data-id="{{item.id}}"
              data-name="{{item.name}}"
            ></van-button>

            <van-button class="delete-btn" size="small" round
              type="danger" icon="delete" plain catch:tap="onDeleteWorker"
              data-id="{{item.id}}"
              data-name="{{item.name}}"
            ></van-button>
          </view>
        </view>
      </view>
    </block>
  </view>

  <van-dialog id="van-dialog" />
</view>

<!-- 右下角悬浮添加按钮 -->
<view class="fab" bindtap="openAddPopup" hover-class="fab-hover">
  <van-icon name="plus" size="24px" color="#ffffff" />
</view>

<!-- 新增工人弹窗 -->
<van-popup
  show="{{showAddPopup}}"
  round
  position="bottom"
  custom-style="min-height: 60vh;"
  bind:close="closeAddPopup">

  <view class="popup-header">新增工人</view>

  <view class="form">
    <!-- 头像上传 -->
    <view class="form-item">
      <view class="label">头像</view>
      <van-uploader
        accept="image"
        capture="camera"
        max-count="1"
        preview-image
        deletable
        file-list="{{avatarFileList}}"
        bind:after-read="onAvatarAfterRead"
        bind:delete="onAvatarDelete" />
    </view>

    <!-- 姓名 -->
    <van-field
      label="姓名"
      placeholder="请输入姓名"
      value="{{form.name}}"
      bind:change="onFieldChange"
      data-field="name"
      required
    />

    <!-- 电话 -->
    <van-field
      label="电话"
      placeholder="请输入手机号"
      type="tel"
      maxlength="20"
      value="{{form.phone}}"
      bind:change="onFieldChange"
      data-field="phone"
    />

    <view class="btn-row">
      <van-button
        class="btn"
        type="primary"
        round
        block
        bind:tap="onSubmit">保存</van-button>
    </view>
  </view>
</van-popup>
</view>

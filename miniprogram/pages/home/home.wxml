<view class="section user-card">
  <view class="user-left">
    <van-image
      round
      width="64px"
      height="64px"
      lazy-load
      src="{{loggedIn ? userInfo.avatarUrl : defaultAvatarUrl}}" />
  </view>
  <view class="user-right">
    <view class="user-name">
      {{ loggedIn ? (userInfo.nickName || userInfo.name || '已登录') : '未登录' }}
      <block wx:if="{{loggedIn}}">
        <van-tag wx:if="{{companyBinded}}" type="success" plain size="medium" class="ml8">已绑定</van-tag>
        <van-tag wx:else type="danger" plain size="medium" class="ml8">请绑定隶属公司</van-tag>
      </block>
    </view>
    <view class="user-sub">
      {{ loggedIn ? '欢迎回来' : '登录并绑定公司后可同步称重数据' }}
    </view>
  </view>

  <view class="user-actions">
    <van-button
      wx:if="{{!loggedIn}}"
      type="primary"
      size="small"
      round
      icon="user-o"
      bind:tap="onLogin">
      立即登录
    </van-button>

    <van-button
      wx:if="{{loggedIn}}"
      type="danger"
      plain
      size="small"
      round
      icon="close"
      bind:tap="onLogout">
      退出登录
    </van-button>
  </view>
</view>

<van-cell-group inset class="section card" border="{{false}}">
  <!-- 公司绑定信息 -->
  <van-cell
    title-class="van-ellipsis"
    title="{{companyBinded ? company.name : '公司' }}"
    icon="home-o"
    value="{{ companyBinded ? '更换绑定' : '未绑定' }}"
    is-link
    bind:tap="onBindCompany" />

  <!-- 查询采摘历史 -->
  <van-cell
    title="采摘日历"
    icon="calendar-o"
    is-link
    bind:tap="goCalendar" />

  <!-- 设置图标元数据 -->
  <van-cell title="图表天数" label="折线图展示最近 N 天" icon="setting-o" use-label-slot border="{{false}}">
    <view slot="right-icon" class="stepper-wrap">
      <van-stepper value="{{chartDays}}"
                   min="3" max="30" step="1"
                   bind:change="onChartDaysChange" />
    </view>
  </van-cell>
</van-cell-group>

<!-- 近几天采摘数据图表（预留区） -->
<view class="section card chart-card">
  <view class="chart-header">
    <view class="chart-title">近{{chartDays}}天采摘重量</view>
    <van-icon name="chart-trending-o" size="40rpx"/>
  </view>

  <!-- 还未接入图表时的占位 -->
  <view wx:if="{{!hasChartData}}" class="chart-placeholder">
    <van-empty description="暂无数据，登录并完成称重后查看" />
  </view>

  <!-- 预留 canvas，后续接入 ECharts/F2/自研绘图即可复用 -->
  <canvas
    wx:if="{{hasChartData}}"
    type="2d"
    id="chartCanvas"
    class="chart-canvas">
  </canvas>
</view>

<van-divider />
<view class="safe-bottom" />

<van-dialog
  id="van-dialog"
  use-slot
  title="输入邀请码">
  <view class="bind-form">
    <van-field
      model:value="{{ inviteCode }}"
      placeholder="请输入公司邀请码"
      border="{{ false }}"
      bind:change="onCompanyCodeChange" />
  </view>
</van-dialog>

<!-- <van-button bind:tap="genCompanyCode">获取</van-button> -->
